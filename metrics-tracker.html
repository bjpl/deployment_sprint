<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Metrics Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 12px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 8px;
        }

        h2 {
            font-size: 1.3em;
            margin-bottom: 16px;
            color: var(--text);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--primary);
            background: var(--bg);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .project-card {
            background: var(--surface);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .project-name {
            font-size: 1.3em;
            font-weight: 600;
        }

        .project-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-paused {
            background: #fef3c7;
            color: #92400e;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .metric-input {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .metric-input label {
            font-size: 0.85em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .metric-input input {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.2s;
        }

        .metric-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .calculated-metrics {
            margin-top: 20px;
            padding: 20px;
            background: #f0fdf4;
            border-radius: 8px;
            border: 1px solid #86efac;
        }

        .calculated-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .calc-metric {
            text-align: center;
        }

        .calc-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .calc-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--success);
        }

        .calc-subtext {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .portfolio-summary {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
        }

        .summary-label {
            font-size: 0.9em;
            color: #1e40af;
            font-weight: 500;
            margin-top: 4px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        button.success {
            background: var(--success);
        }

        button.success:hover {
            background: #059669;
        }

        button.secondary {
            background: var(--text-secondary);
        }

        button.danger {
            background: var(--danger);
        }

        .week-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 8px 16px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .week-btn:hover {
            border-color: var(--primary);
            background: #dbeafe;
        }

        .week-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .week-btn.completed {
            background: #d1fae5;
            border-color: var(--success);
        }

        .trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.9em;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .trend.up {
            background: #d1fae5;
            color: #065f46;
        }

        .trend.down {
            background: #fee2e2;
            color: #991b1b;
        }

        .trend.neutral {
            background: #f1f5f9;
            color: var(--text-secondary);
        }

        .copy-btn {
            background: var(--warning);
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .copy-btn:hover {
            background: #d97706;
        }

        .helper-text {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 8px;
            font-style: italic;
        }

        .snapshot-history {
            margin-top: 20px;
            padding: 16px;
            background: var(--surface);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg);
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        td {
            font-size: 0.95em;
        }

        tr:hover {
            background: var(--bg);
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: var(--surface);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 200px;
            margin-top: 12px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(180deg, var(--primary) 0%, #2563eb 100%);
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 10px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text);
        }

        .bar-label {
            margin-top: 8px;
            font-size: 0.8em;
            color: var(--text-secondary);
            text-align: center;
        }

        .alert-box {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .alert-success {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            padding: 32px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Portfolio Metrics Tracker</h1>
            <p>Track all metrics for your 6-project deployment sprint</p>
        </header>

        <div class="controls">
            <button onclick="addSnapshot()" class="success">ðŸ“¸ Save Weekly Snapshot</button>
            <button onclick="showCopyModal()">ðŸ“‹ Copy to Sprint Tracker</button>
            <button onclick="exportData()">ðŸ’¾ Export Data</button>
            <button onclick="importData()" class="secondary">ðŸ“¥ Import Data</button>
            <button onclick="resetData()" class="danger">ðŸ”„ Reset All</button>
        </div>

        <div class="alert-box alert-info">
            <strong>ðŸ’¡ How to use:</strong> Enter your current numbers below. Calculated metrics update automatically.
            Click "ðŸ“¸ Save Weekly Snapshot" every Sunday to track trends. Use "ðŸ“‹ Copy to Sprint Tracker" to paste into your deployment tracker gates.
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('current')">ðŸ“Š Current Metrics</button>
            <button class="tab" onclick="switchTab('projects')">ðŸ“± By Project</button>
            <button class="tab" onclick="switchTab('history')">ðŸ“ˆ History & Trends</button>
            <button class="tab" onclick="switchTab('calculator')">ðŸ§® Calculator</button>
        </div>

        <!-- Current Metrics Tab -->
        <div id="current-tab" class="tab-content active">
            <div class="portfolio-summary">
                <h2>Portfolio Overview</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value" id="portfolio-signups">0</div>
                        <div class="summary-label">Total Signups</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="portfolio-active">0</div>
                        <div class="summary-label">Weekly Active</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="portfolio-paying">0</div>
                        <div class="summary-label">Paying Customers</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="portfolio-mrr">$0</div>
                        <div class="summary-label">MRR</div>
                    </div>
                </div>
            </div>

            <div class="project-card">
                <h2>ðŸ“¥ Input Your Numbers</h2>
                <div class="metrics-grid">
                    <div class="metric-input">
                        <label>Total Signups (All Projects)</label>
                        <input type="number" id="total-signups" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Cumulative across all apps</span>
                    </div>
                    <div class="metric-input">
                        <label>Weekly Active Users</label>
                        <input type="number" id="weekly-active" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Users active in last 7 days</span>
                    </div>
                    <div class="metric-input">
                        <label>Daily Active Users</label>
                        <input type="number" id="daily-active" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Average users per day</span>
                    </div>
                    <div class="metric-input">
                        <label>Paying Customers</label>
                        <input type="number" id="paying-customers" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Active subscriptions</span>
                    </div>
                    <div class="metric-input">
                        <label>Total Revenue This Month ($)</label>
                        <input type="number" id="total-revenue" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Actual $ collected this month</span>
                    </div>
                    <div class="metric-input">
                        <label>Cancelled This Month</label>
                        <input type="number" id="cancelled" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Churned customers</span>
                    </div>
                    <div class="metric-input">
                        <label>Marketing Spend ($)</label>
                        <input type="number" id="marketing-spend" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Paid ads, tools, etc.</span>
                    </div>
                    <div class="metric-input">
                        <label>Infrastructure Cost ($)</label>
                        <input type="number" id="infra-cost" placeholder="0" oninput="calculateMetrics()">
                        <span class="helper-text">Hosting, services, APIs</span>
                    </div>
                </div>
            </div>

            <div class="calculated-metrics">
                <h2>âœ¨ Auto-Calculated Metrics</h2>
                <div class="calculated-grid">
                    <div class="calc-metric">
                        <div class="calc-label">MRR</div>
                        <div class="calc-value" id="calc-mrr">$0</div>
                        <div class="calc-subtext">Monthly Recurring Revenue</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Conversion Rate</div>
                        <div class="calc-value" id="calc-conversion">0%</div>
                        <div class="calc-subtext">Paying / Total Signups</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Churn Rate</div>
                        <div class="calc-value" id="calc-churn">0%</div>
                        <div class="calc-subtext">Cancelled / Paying</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Activation Rate</div>
                        <div class="calc-value" id="calc-activation">0%</div>
                        <div class="calc-subtext">Active / Signups</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">ARPU</div>
                        <div class="calc-value" id="calc-arpu">$0</div>
                        <div class="calc-subtext">Avg Revenue Per User</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Net Profit</div>
                        <div class="calc-value" id="calc-profit">$0</div>
                        <div class="calc-subtext">Revenue - Costs</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- By Project Tab -->
        <div id="projects-tab" class="tab-content">
            <div id="project-cards-container"></div>
            <button onclick="addProject()" class="success">âž• Add Project</button>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
            <h2>ðŸ“ˆ Weekly Snapshots</h2>
            <div class="week-selector" id="week-selector"></div>

            <div class="chart-container">
                <h3>MRR Growth Trend</h3>
                <div class="bar-chart" id="mrr-chart"></div>
            </div>

            <div class="snapshot-history">
                <h3>Snapshot Comparison</h3>
                <table id="snapshot-table">
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Date</th>
                            <th>Signups</th>
                            <th>Active</th>
                            <th>Paying</th>
                            <th>MRR</th>
                            <th>Conv %</th>
                            <th>Churn %</th>
                        </tr>
                    </thead>
                    <tbody id="snapshot-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Calculator Tab -->
        <div id="calculator-tab" class="tab-content">
            <h2>ðŸ§® Business Metrics Calculator</h2>

            <div class="project-card">
                <h3>LTV (Lifetime Value) Calculator</h3>
                <div class="metrics-grid">
                    <div class="metric-input">
                        <label>Avg Monthly Revenue per Customer ($)</label>
                        <input type="number" id="ltv-arpu" placeholder="5" oninput="calculateLTV()">
                    </div>
                    <div class="metric-input">
                        <label>Avg Customer Lifetime (months)</label>
                        <input type="number" id="ltv-lifetime" placeholder="12" oninput="calculateLTV()">
                        <span class="helper-text">1 / (churn rate / 100)</span>
                    </div>
                    <div class="metric-input">
                        <label>Gross Margin (%)</label>
                        <input type="number" id="ltv-margin" placeholder="70" oninput="calculateLTV()">
                        <span class="helper-text">Usually 60-80% for SaaS</span>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Customer LTV</div>
                        <div class="calc-value" id="result-ltv">$0</div>
                        <div class="calc-subtext">ARPU Ã— Lifetime Ã— Margin</div>
                    </div>
                </div>
            </div>

            <div class="project-card">
                <h3>CAC (Customer Acquisition Cost) Calculator</h3>
                <div class="metrics-grid">
                    <div class="metric-input">
                        <label>Total Marketing Spend ($)</label>
                        <input type="number" id="cac-spend" placeholder="100" oninput="calculateCAC()">
                    </div>
                    <div class="metric-input">
                        <label>New Customers Acquired</label>
                        <input type="number" id="cac-customers" placeholder="10" oninput="calculateCAC()">
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">CAC</div>
                        <div class="calc-value" id="result-cac">$0</div>
                        <div class="calc-subtext">Spend / Customers</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">LTV:CAC Ratio</div>
                        <div class="calc-value" id="result-ltv-cac">0:1</div>
                        <div class="calc-subtext">Target: 3:1 or higher</div>
                    </div>
                </div>
            </div>

            <div class="project-card">
                <h3>Break-Even Calculator</h3>
                <div class="metrics-grid">
                    <div class="metric-input">
                        <label>Monthly Fixed Costs ($)</label>
                        <input type="number" id="be-costs" placeholder="125" oninput="calculateBreakEven()">
                        <span class="helper-text">Hosting, tools, subscriptions</span>
                    </div>
                    <div class="metric-input">
                        <label>Avg Revenue per Customer ($)</label>
                        <input type="number" id="be-arpu" placeholder="7" oninput="calculateBreakEven()">
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Break-Even Point</div>
                        <div class="calc-value" id="result-be-customers">0</div>
                        <div class="calc-subtext">Customers needed</div>
                    </div>
                    <div class="calc-metric">
                        <div class="calc-label">Current Status</div>
                        <div class="calc-value" id="result-be-status">â€”</div>
                        <div class="calc-subtext" id="result-be-subtext">â€”</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy Modal -->
    <div id="copyModal" class="modal">
        <div class="modal-content">
            <h2>ðŸ“‹ Copy Metrics for Sprint Tracker</h2>
            <p>These metrics are ready to paste into your deployment sprint tracker gates:</p>
            <div style="margin-top: 20px;">
                <h3>Current Values:</h3>
                <textarea id="copy-text" readonly style="width: 100%; height: 300px; padding: 12px; font-family: monospace; font-size: 0.9em; border: 1px solid var(--border); border-radius: 6px;"></textarea>
            </div>
            <div style="margin-top: 16px; display: flex; gap: 10px;">
                <button onclick="copyToClipboard()" class="success">ðŸ“‹ Copy to Clipboard</button>
                <button onclick="closeModal()" class="secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Export/Import Modals -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h2>ðŸ’¾ Export Metrics Data</h2>
            <p>Copy this JSON to backup your metrics:</p>
            <textarea id="exportData" readonly style="width: 100%; height: 300px; padding: 12px; font-family: monospace; font-size: 0.9em;"></textarea>
            <div style="margin-top: 16px; display: flex; gap: 10px;">
                <button onclick="copyExport()" class="success">ðŸ“‹ Copy</button>
                <button onclick="closeModal()" class="secondary">Close</button>
            </div>
        </div>
    </div>

    <div id="importModal" class="modal">
        <div class="modal-content">
            <h2>ðŸ“¥ Import Metrics Data</h2>
            <p>Paste your exported JSON:</p>
            <textarea id="importData" placeholder="Paste JSON here..." style="width: 100%; height: 300px; padding: 12px; font-family: monospace; font-size: 0.9em;"></textarea>
            <div style="margin-top: 16px; display: flex; gap: 10px;">
                <button onclick="doImport()">âœ… Import</button>
                <button onclick="closeModal()" class="secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let metricsState = {
            current: {
                totalSignups: 0,
                weeklyActive: 0,
                dailyActive: 0,
                payingCustomers: 0,
                totalRevenue: 0,
                cancelled: 0,
                marketingSpend: 0,
                infraCost: 0
            },
            projects: [],
            snapshots: [],
            version: '1.0'
        };

        // Initialize
        function init() {
            loadMetricsState();
            calculateMetrics();
            renderProjectCards();
            renderHistory();
        }

        // Load from localStorage
        function loadMetricsState() {
            const saved = localStorage.getItem('portfolioMetrics');
            if (saved) {
                metricsState = JSON.parse(saved);

                // Populate inputs
                if (metricsState.current) {
                    document.getElementById('total-signups').value = metricsState.current.totalSignups || 0;
                    document.getElementById('weekly-active').value = metricsState.current.weeklyActive || 0;
                    document.getElementById('daily-active').value = metricsState.current.dailyActive || 0;
                    document.getElementById('paying-customers').value = metricsState.current.payingCustomers || 0;
                    document.getElementById('total-revenue').value = metricsState.current.totalRevenue || 0;
                    document.getElementById('cancelled').value = metricsState.current.cancelled || 0;
                    document.getElementById('marketing-spend').value = metricsState.current.marketingSpend || 0;
                    document.getElementById('infra-cost').value = metricsState.current.infraCost || 0;
                }
            }
        }

        // Save to localStorage
        function saveMetricsState() {
            localStorage.setItem('portfolioMetrics', JSON.stringify(metricsState));
            localStorage.setItem('portfolioMetricsLastSave', new Date().toISOString());
        }

        // Calculate derived metrics
        function calculateMetrics() {
            // Get current inputs
            const signups = parseInt(document.getElementById('total-signups').value) || 0;
            const weeklyActive = parseInt(document.getElementById('weekly-active').value) || 0;
            const dailyActive = parseInt(document.getElementById('daily-active').value) || 0;
            const paying = parseInt(document.getElementById('paying-customers').value) || 0;
            const revenue = parseFloat(document.getElementById('total-revenue').value) || 0;
            const cancelled = parseInt(document.getElementById('cancelled').value) || 0;
            const marketingSpend = parseFloat(document.getElementById('marketing-spend').value) || 0;
            const infraCost = parseFloat(document.getElementById('infra-cost').value) || 0;

            // Update state
            metricsState.current = {
                totalSignups: signups,
                weeklyActive: weeklyActive,
                dailyActive: dailyActive,
                payingCustomers: paying,
                totalRevenue: revenue,
                cancelled: cancelled,
                marketingSpend: marketingSpend,
                infraCost: infraCost
            };

            // Calculate derived metrics
            const mrr = revenue; // Assuming monthly revenue = MRR
            const conversionRate = signups > 0 ? (paying / signups * 100).toFixed(1) : 0;
            const churnRate = paying > 0 ? (cancelled / paying * 100).toFixed(1) : 0;
            const activationRate = signups > 0 ? (weeklyActive / signups * 100).toFixed(1) : 0;
            const arpu = paying > 0 ? (revenue / paying).toFixed(2) : 0;
            const profit = revenue - marketingSpend - infraCost;

            // Update displays
            document.getElementById('portfolio-signups').textContent = signups;
            document.getElementById('portfolio-active').textContent = weeklyActive;
            document.getElementById('portfolio-paying').textContent = paying;
            document.getElementById('portfolio-mrr').textContent = '$' + mrr;

            document.getElementById('calc-mrr').textContent = '$' + mrr;
            document.getElementById('calc-conversion').textContent = conversionRate + '%';
            document.getElementById('calc-churn').textContent = churnRate + '%';
            document.getElementById('calc-activation').textContent = activationRate + '%';
            document.getElementById('calc-arpu').textContent = '$' + arpu;
            document.getElementById('calc-profit').textContent = '$' + profit.toFixed(0);

            saveMetricsState();
        }

        // Add weekly snapshot
        function addSnapshot() {
            const signups = parseInt(document.getElementById('total-signups').value) || 0;
            const weeklyActive = parseInt(document.getElementById('weekly-active').value) || 0;
            const paying = parseInt(document.getElementById('paying-customers').value) || 0;
            const revenue = parseFloat(document.getElementById('total-revenue').value) || 0;

            if (signups === 0 && weeklyActive === 0 && paying === 0 && revenue === 0) {
                alert('âš ï¸ Please enter some metrics first!');
                return;
            }

            const snapshot = {
                week: metricsState.snapshots.length + 1,
                date: new Date().toISOString(),
                ...metricsState.current,
                // Calculated
                mrr: revenue,
                conversionRate: signups > 0 ? (paying / signups * 100).toFixed(1) : 0,
                churnRate: paying > 0 ? (metricsState.current.cancelled / paying * 100).toFixed(1) : 0,
                activationRate: signups > 0 ? (weeklyActive / signups * 100).toFixed(1) : 0,
                arpu: paying > 0 ? (revenue / paying).toFixed(2) : 0,
                profit: revenue - metricsState.current.marketingSpend - metricsState.current.infraCost
            };

            metricsState.snapshots.push(snapshot);
            saveMetricsState();
            renderHistory();

            // Success feedback
            const btn = event.target;
            const orig = btn.textContent;
            btn.textContent = 'âœ… Snapshot Saved!';
            btn.style.background = '#059669';
            setTimeout(() => {
                btn.textContent = orig;
                btn.style.background = '';
            }, 2000);
        }

        // Render history
        function renderHistory() {
            // Render chart
            const chartHTML = metricsState.snapshots.map((snap, idx) => {
                const maxMRR = Math.max(...metricsState.snapshots.map(s => s.mrr), 100);
                const height = (snap.mrr / maxMRR) * 100;

                return `
                    <div class="bar" style="height: ${height}%">
                        <div class="bar-value">$${snap.mrr}</div>
                    </div>
                    <div class="bar-label">W${snap.week}</div>
                `;
            }).join('') || '<p style="text-align: center; color: var(--text-secondary); padding: 50px;">No snapshots yet. Click "ðŸ“¸ Save Weekly Snapshot" to start tracking.</p>';

            document.getElementById('mrr-chart').innerHTML = chartHTML;

            // Render table
            const tableHTML = metricsState.snapshots.map(snap => {
                const date = new Date(snap.date).toLocaleDateString();
                return `
                    <tr>
                        <td><strong>Week ${snap.week}</strong></td>
                        <td>${date}</td>
                        <td>${snap.totalSignups}</td>
                        <td>${snap.weeklyActive}</td>
                        <td>${snap.payingCustomers}</td>
                        <td><strong>$${snap.mrr}</strong></td>
                        <td>${snap.conversionRate}%</td>
                        <td>${snap.churnRate}%</td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary); padding: 20px;">No snapshots recorded yet</td></tr>';

            document.getElementById('snapshot-tbody').innerHTML = tableHTML;
        }

        // Show copy modal
        function showCopyModal() {
            const signups = parseInt(document.getElementById('total-signups').value) || 0;
            const weeklyActive = parseInt(document.getElementById('weekly-active').value) || 0;
            const paying = parseInt(document.getElementById('paying-customers').value) || 0;
            const revenue = parseFloat(document.getElementById('total-revenue').value) || 0;

            const conversionRate = signups > 0 ? (paying / signups * 100).toFixed(1) : 0;
            const cancelled = parseInt(document.getElementById('cancelled').value) || 0;
            const churnRate = paying > 0 ? (cancelled / paying * 100).toFixed(1) : 0;

            const copyText = `ðŸ“Š Current Portfolio Metrics
Generated: ${new Date().toLocaleString()}

PASTE THESE INTO SPRINT TRACKER GATES:
(Click "ðŸ“Š Update Current Metrics" in sprint tracker and enter these)

Total Signups: ${signups}
Weekly Active Users: ${weeklyActive}
Paying Customers: ${paying}
MRR: ${revenue}

CALCULATED METRICS:
Conversion Rate: ${conversionRate}%
Churn Rate: ${churnRate}%

HOW TO USE:
1. Copy this text (click button below)
2. Open deployment-sprint-tracker.html
3. Click "ðŸ“Š Update Current Metrics" button
4. Enter the numbers above
5. Click "Save Metrics"

Or for weekly gates (Day 27, 34, 41, 48):
1. Navigate to that day
2. Scroll to yellow metrics section
3. Enter these values in the fields
4. Auto-saves as you type
`;

            document.getElementById('copy-text').value = copyText;
            document.getElementById('copyModal').classList.add('show');
        }

        // Copy to clipboard
        function copyToClipboard() {
            const textarea = document.getElementById('copy-text');
            textarea.select();
            document.execCommand('copy');

            const btn = event.target;
            btn.textContent = 'âœ… Copied!';
            setTimeout(() => {
                btn.textContent = 'ðŸ“‹ Copy to Clipboard';
            }, 2000);
        }

        // Calculate LTV
        function calculateLTV() {
            const arpu = parseFloat(document.getElementById('ltv-arpu').value) || 0;
            const lifetime = parseFloat(document.getElementById('ltv-lifetime').value) || 0;
            const margin = parseFloat(document.getElementById('ltv-margin').value) || 0;

            const ltv = arpu * lifetime * (margin / 100);
            document.getElementById('result-ltv').textContent = '$' + ltv.toFixed(0);

            calculateLTVCAC();
        }

        // Calculate CAC
        function calculateCAC() {
            const spend = parseFloat(document.getElementById('cac-spend').value) || 0;
            const customers = parseInt(document.getElementById('cac-customers').value) || 0;

            const cac = customers > 0 ? spend / customers : 0;
            document.getElementById('result-cac').textContent = '$' + cac.toFixed(0);

            calculateLTVCAC();
        }

        // Calculate LTV:CAC ratio
        function calculateLTVCAC() {
            const ltvText = document.getElementById('result-ltv').textContent.replace('$', '');
            const cacText = document.getElementById('result-cac').textContent.replace('$', '');

            const ltv = parseFloat(ltvText) || 0;
            const cac = parseFloat(cacText) || 0;

            if (cac > 0) {
                const ratio = (ltv / cac).toFixed(1);
                document.getElementById('result-ltv-cac').textContent = ratio + ':1';

                // Color code
                const el = document.getElementById('result-ltv-cac');
                if (ratio >= 3) {
                    el.style.color = '#10b981'; // Green
                } else if (ratio >= 2) {
                    el.style.color = '#f59e0b'; // Yellow
                } else {
                    el.style.color = '#ef4444'; // Red
                }
            }
        }

        // Calculate break-even
        function calculateBreakEven() {
            const costs = parseFloat(document.getElementById('be-costs').value) || 0;
            const arpu = parseFloat(document.getElementById('be-arpu').value) || 0;

            const beCustomers = arpu > 0 ? Math.ceil(costs / arpu) : 0;
            document.getElementById('result-be-customers').textContent = beCustomers;

            const currentPaying = parseInt(document.getElementById('paying-customers').value) || 0;
            const currentRevenue = parseFloat(document.getElementById('total-revenue').value) || 0;

            if (currentRevenue >= costs) {
                document.getElementById('result-be-status').textContent = 'âœ… Profitable';
                document.getElementById('result-be-status').style.color = '#10b981';
                document.getElementById('result-be-subtext').textContent = `+$${(currentRevenue - costs).toFixed(0)} profit`;
            } else if (currentPaying > 0) {
                const needed = beCustomers - currentPaying;
                document.getElementById('result-be-status').textContent = 'âš ï¸ Growing';
                document.getElementById('result-be-status').style.color = '#f59e0b';
                document.getElementById('result-be-subtext').textContent = `Need ${needed} more customers`;
            } else {
                document.getElementById('result-be-status').textContent = 'ðŸš€ Pre-Revenue';
                document.getElementById('result-be-status').style.color = '#3b82f6';
                document.getElementById('result-be-subtext').textContent = 'Focus on launch first';
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'history') {
                renderHistory();
            }
        }

        // Export data
        function exportData() {
            const exportObj = {
                ...metricsState,
                exportDate: new Date().toISOString()
            };
            document.getElementById('exportData').value = JSON.stringify(exportObj, null, 2);
            document.getElementById('exportModal').classList.add('show');
        }

        // Import data
        function importData() {
            document.getElementById('importModal').classList.add('show');
        }

        function doImport() {
            try {
                const data = JSON.parse(document.getElementById('importData').value);
                metricsState = data;
                saveMetricsState();
                loadMetricsState();
                calculateMetrics();
                renderHistory();
                alert('âœ… Data imported successfully!');
                closeModal();
            } catch (e) {
                alert('âŒ Invalid JSON. Please check your data.');
            }
        }

        // Copy export
        function copyExport() {
            const textarea = document.getElementById('exportData');
            textarea.select();
            document.execCommand('copy');
            alert('âœ… Copied to clipboard!');
        }

        // Reset
        function resetData() {
            if (confirm('âš ï¸ Reset all metrics data? This cannot be undone.')) {
                localStorage.removeItem('portfolioMetrics');
                location.reload();
            }
        }

        // Close modal
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
        }

        // Render project cards
        function renderProjectCards() {
            const container = document.getElementById('project-cards-container');

            if (metricsState.projects.length === 0) {
                container.innerHTML = `
                    <div class="alert-box alert-info">
                        <strong>ðŸ’¡ Track per-project metrics:</strong> Click "âž• Add Project" to track metrics for each app individually (describe_it, subjunctive_practice, etc.)
                    </div>
                `;
                return;
            }

            // Render projects
            container.innerHTML = metricsState.projects.map((project, idx) => `
                <div class="project-card">
                    <div class="project-header">
                        <div class="project-name">${project.name}</div>
                        <span class="project-status ${project.active ? 'status-active' : 'status-paused'}">
                            ${project.active ? 'Active' : 'Paused'}
                        </span>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-input">
                            <label>Signups</label>
                            <input type="number" value="${project.signups || 0}"
                                   oninput="updateProject(${idx}, 'signups', this.value)">
                        </div>
                        <div class="metric-input">
                            <label>Weekly Active</label>
                            <input type="number" value="${project.weeklyActive || 0}"
                                   oninput="updateProject(${idx}, 'weeklyActive', this.value)">
                        </div>
                        <div class="metric-input">
                            <label>Paying</label>
                            <input type="number" value="${project.paying || 0}"
                                   oninput="updateProject(${idx}, 'paying', this.value)">
                        </div>
                        <div class="metric-input">
                            <label>MRR ($)</label>
                            <input type="number" value="${project.mrr || 0}"
                                   oninput="updateProject(${idx}, 'mrr', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Add project
        function addProject() {
            const name = prompt('Enter project name (e.g., describe_it):');
            if (!name) return;

            metricsState.projects.push({
                name: name,
                active: true,
                signups: 0,
                weeklyActive: 0,
                paying: 0,
                mrr: 0
            });

            saveMetricsState();
            renderProjectCards();
        }

        // Update project
        function updateProject(idx, field, value) {
            metricsState.projects[idx][field] = parseFloat(value) || 0;
            saveMetricsState();
        }

        // Initialize on load
        window.onload = init;

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveMetricsState();

                const header = document.querySelector('header');
                const p = header.querySelector('p');
                const orig = p.textContent;
                p.textContent = 'âœ… Metrics Saved!';
                setTimeout(() => {
                    p.textContent = orig;
                }, 1500);
            }

            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Close modals on background click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });
    </script>
</body>
</html>
